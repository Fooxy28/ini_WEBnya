<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tambah Jadwal - Task & Schedule Management</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body class="task-menu-page">
    <div class="dashboard-container">
        <header class="app-header task-form-header">
            <a href="javascript:history.back()" class="back-btn">‚ùÆ</a>
            <h2 class="page-title">Tambah Jadwal</h2>
        </header>

        <form id="addScheduleForm" class="task-form">
            <!-- Schedule Name -->
            <div class="card-input-wrapper">
                <label for="name">Nama Jadwal</label>
                <div class="card-input">
                    <input type="text" id="name" name="name" placeholder="Evaluasi Perangkat Lunak" required>
                </div>
            </div>

            <!-- Note -->
            <div class="card-input-wrapper">
                <label for="note">Note</label>
                <div class="card-input">
                    <textarea id="note" name="note" placeholder="Membahas progres..."></textarea>
                </div>
            </div>

            <!-- Start Date -->
            <div class="card-input-wrapper">
                <label for="start">Start Date</label>
                <div class="card-input date-input">
                    <div class="card-icon bg-purple">üìÖ</div>
                    <input type="datetime-local" id="start" name="start" required>
                </div>
            </div>

            <!-- End Date -->
            <div class="card-input-wrapper">
                <label for="end">End Date</label>
                <div class="card-input date-input">
                    <div class="card-icon bg-purple">üìÖ</div>
                    <input type="datetime-local" id="end" name="end" required>
                </div>
            </div>

            <button type="submit" class="btn btn-block">Tambah Jadwal</button>
        </form>
    </div>

    <script src="../../script.js"></script>
    <script>
        checkAuth();

        // Check for a date passed from the home page calendar via sessionStorage
        const savedDateStr = sessionStorage.getItem('selectedCalendarDate');
        const now = new Date();
        let initialDate = now;

        if (savedDateStr) {
            // Use the date from sessionStorage, but the time from right now
            const savedDate = new Date(savedDateStr);
            savedDate.setHours(now.getHours());
            savedDate.setMinutes(now.getMinutes());
            initialDate = savedDate;
        }

        // Format the date for the input field
        const year = initialDate.getFullYear();
        const month = String(initialDate.getMonth() + 1).padStart(2, '0');
        const day = String(initialDate.getDate()).padStart(2, '0');
        const hours = String(initialDate.getHours()).padStart(2, '0');
        const minutes = String(initialDate.getMinutes()).padStart(2, '0');
        const formattedDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;

        // Set the value
        document.getElementById('start').value = formattedDateTime;

        document.getElementById('addScheduleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newSchedule = {
                name: document.getElementById('name').value,
                note: document.getElementById('note').value,
                start: document.getElementById('start').value,
                end: document.getElementById('end').value
            };

            saveSchedule(newSchedule);
            alert('Jadwal berhasil ditambahkan!');
            window.location.href = '../home.html';
        });
    </script>
</body>
</html>